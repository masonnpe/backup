---
title: 使用缓存伴随的问题
categories: Redis
tags: [Redis]
---

## 缓存与数据库双写不一致

先删，再更新数据库      有的时候，某些字段需要进行复杂的运算    数据读<写的话   要是更新缓存就很浪费了 懒加载思想

严格要求缓存+数据库必须一致性的话，读请求和写请求串行化，串到一个内存队列里去，这样就可以保证一定不会出现不一致的情况

但是串行化之后，就会导致系统的吞吐量会大幅度的降低，用比正常情况下多几倍的机器去支撑线上的一个请求。

## 缓存一致性

要求数据更新的同时缓存数据也能够实时更新。

解决方案：

- 在数据更新的同时立即去更新缓存；
- 在读缓存之前先判断缓存是否是最新的，如果不是最新的先进行更新。

要保证缓存一致性需要付出很大的代价，缓存数据最好是那些对一致性要求不高的数据，允许缓存数据存在一些脏数据。

## 缓存雪崩    

指的是由于数据没有被加载到缓存中，或者缓存数据在同一时间大面积失效（过期），又或者缓存服务器宕机，导致大量的请求都到达数据库，数据库无法处理这么大的请求，数据库也崩了，然后全崩了。



缓存雪崩的事前事中事后的解决方案 

事前：redis高可用，主从+哨兵，redis cluster，避免全盘崩溃   

​	  合理设置缓存过期时间，防止缓存在同一时间大面积过期导致的缓存雪崩

​	 缓存预热，避免在系统刚启动不久由于还未将大量数据进行缓存而导致缓存雪崩

事中：本地ehcache缓存 + hystrix限流&降级，避免MySQL被打死

事后：redis持久化，快速恢复缓存数据​	

## 缓存并发竞争

多客户端同时写key，用分布式锁+版本号

## 缓存穿透

指的是对某个一定不存在的数据进行请求，该请求将会穿透缓存一直请求数据库。

解决方案：

- 对这些不存在的数据缓存一个空数据；
- 对这类请求进行过滤。